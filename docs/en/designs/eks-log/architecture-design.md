# EKS Cluster Log Analytics Design

## Overview

Considering that there are many types of logs in EKS, and different types of logs have different collection sources. But in general, it can be divided into three ways:

- The first type of logs is Control plane logging, which includes Audit logs, API server logs, interfacing with CloudWatch, and Controller manager logs. Such logs need to be subscribed in the log group (/aws/eks/<EKS_Cluster_Name>/cluster) , transfer the newly generated log data to the KDS generated by Log Hub EKS Cluster log Ingestion. We are currently working on Control plane logging.

- The second is the ELB type Ingress access log. If your ELB type is ALB, this part has been implemented in the Service Log component

- The last one is the application log in the EKS cluster and the system log on the Node (kube-proxy-XXX.log, aws-load-balancer-controller, aws-node-<XXX>\_kube-system_aws-vpc-cni- init-XXX.log, aws-node-<XXX>\_kube-system_aws-node-XXX.log, coredns-XXX.log). Regarding the use of Nginx as an Ingress, the Ingress access log generated is essentially an application log. Regarding such logs, we will collect the logs by deploying Fluent Bit as a log agent and send the logs to the data buffer created by Log Hub.

## System Architecture

![Application log Pipeline ](../../images/architecture/eks-cluster-log-deployment.png)

## FAQ

**Q. What is the difference between the log pipeline of an EKS cluster and the log pipeline of an application?**

Considering whether the application is deployed in EC2 or EKS Cluster, there is usually no difference in the application log format, but the analysis methods for logs from different sources are still different. When we designed EKS Cluster log analysis, we abstracted the concept of ==log source== in the application log ingestion component. Therefore, EKS Cluster's log pipeline still uses the application log pipeline. When an EKS Cluster log pipeline is created, a log ingestion is created together

**Q. Which deployment mode does the log agent support?**

Whether you choose the DaemonSet type or SideCar, the Log Hub supportsã€‚

**Q. Is the deployment of the log agent performed automatically by the system?**

We do not support fully automated deployment yet. Currently, the Log Hub will generate a Yaml file for deployment, so that you can make changes according to your actual scenarios. In the future we will do this through the Lambda with a Kubectl environment.
